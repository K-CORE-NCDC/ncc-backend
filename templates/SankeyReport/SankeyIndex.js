idName = "chart";
SankeyJson = {
  nodes: [
    { name: "TP53", type: "hugo_symbol" },
    { name: "Splice_Site", type: "variant_classification" },
    { name: "rs11575997", type: "dbsnp_rs" },
    { name: "stomach cancer", type: "diseasename" },
    { name: "rs863224499", type: "dbsnp_rs" },
    { name: "rs1131691042", type: "dbsnp_rs" },
    { name: "rs786201057", type: "dbsnp_rs" },
    { name: "Mitotane", type: "drugname" },
    { name: "Axitinib", type: "drugname" },
    { name: "Sifalimumab", type: "drugname" },
    { name: "Aldesleukin", type: "drugname" },
    { name: "CreaVax-RCC", type: "drugname" },
    { name: "Temsirolimus", type: "drugname" },
    { name: "Pazopanib", type: "drugname" },
    { name: "Everolimus", type: "drugname" },
    { name: "Reniale", type: "drugname" },
    { name: "Sorafenib", type: "drugname" },
    { name: "Tivozanib", type: "drugname" },
    { name: "Tremetinib", type: "drugname" },
    { name: "Antacids", type: "drugname" },
    { name: "Ramucirumab", type: "drugname" },
    { name: "rs1057520003", type: "dbsnp_rs" },
    { name: "rs730881997", type: "dbsnp_rs" },
    { name: "rs1267047192", type: "dbsnp_rs" },
    { name: "rs1131691033", type: "dbsnp_rs" },
    { name: "rs876660156", type: "dbsnp_rs" },
    { name: "rs886041285", type: "dbsnp_rs" },
    { name: "rs1310956961", type: "dbsnp_rs" },
    { name: "rs1057520387", type: "dbsnp_rs" },
    { name: "rs1064795056", type: "dbsnp_rs" },
    { name: "rs969930693", type: "dbsnp_rs" },
    { name: "rs11575996", type: "dbsnp_rs" },
    { name: "ovarian cancer", type: "diseasename" },
    { name: "pancreatic cancer", type: "diseasename" },
    { name: "brain cancer", type: "diseasename" },
    { name: "sarcoma", type: "diseasename" },
    { name: "head and neck cancer", type: "diseasename" },
    { name: "cervical cancer", type: "diseasename" },
    { name: "esophageal cancer", type: "diseasename" },
    { name: "fallopian tube cancer", type: "diseasename" },
  ],

  links: [
    { source: "TP53", target: "Splice_Site", value: 10 },
    { source: "Splice_Site", target: "rs11575997", value: 10 },
    { source: "rs11575997", target: "stomach cancer", value: 10 },
    { source: "Splice_Site", target: "rs863224499", value: 10 },
    { source: "rs863224499", target: "stomach cancer", value: 10 },
    { source: "Splice_Site", target: "rs1131691042", value: 10 },
    { source: "rs1131691042", target: "stomach cancer", value: 10 },
    { source: "Splice_Site", target: "rs786201057", value: 10 },
    { source: "rs786201057", target: "stomach cancer", value: 10 },
    { source: "stomach cancer", target: "Mitotane", value: 10 },
    { source: "stomach cancer", target: "Axitinib", value: 10 },
    { source: "stomach cancer", target: "Sifalimumab", value: 10 },
    { source: "stomach cancer", target: "Aldesleukin", value: 10 },
    { source: "stomach cancer", target: "CreaVax-RCC", value: 10 },
    { source: "stomach cancer", target: "Temsirolimus", value: 10 },
    { source: "stomach cancer", target: "Pazopanib", value: 10 },
    { source: "stomach cancer", target: "Everolimus", value: 10 },
    { source: "stomach cancer", target: "Reniale", value: 10 },
    { source: "stomach cancer", target: "Sorafenib", value: 10 },
    { source: "stomach cancer", target: "Tivozanib", value: 10 },
    { source: "stomach cancer", target: "Tremetinib", value: 10 },
    { source: "stomach cancer", target: "Antacids", value: 10 },
    { source: "stomach cancer", target: "Ramucirumab", value: 10 },
    { source: "Splice_Site", target: "rs1057520003", value: 10 },
    { source: "rs1057520003", target: "stomach cancer", value: 10 },
    { source: "Splice_Site", target: "rs730881997", value: 10 },
    { source: "rs730881997", target: "stomach cancer", value: 10 },
    { source: "Splice_Site", target: "rs1267047192", value: 10 },
    { source: "rs1267047192", target: "stomach cancer", value: 10 },
    { source: "Splice_Site", target: "rs1131691033", value: 10 },
    { source: "rs1131691033", target: "stomach cancer", value: 10 },
    { source: "Splice_Site", target: "rs876660156", value: 10 },
    { source: "rs876660156", target: "stomach cancer", value: 10 },
    { source: "Splice_Site", target: "rs886041285", value: 10 },
    { source: "rs886041285", target: "stomach cancer", value: 10 },
    { source: "Splice_Site", target: "rs1310956961", value: 10 },
    { source: "rs1310956961", target: "stomach cancer", value: 10 },
    { source: "Splice_Site", target: "rs1057520387", value: 10 },
    { source: "rs1057520387", target: "stomach cancer", value: 10 },
    { source: "Splice_Site", target: "rs1064795056", value: 10 },
    { source: "rs1064795056", target: "stomach cancer", value: 10 },
    { source: "Splice_Site", target: "rs969930693", value: 10 },
    { source: "rs969930693", target: "stomach cancer", value: 10 },
    { source: "Splice_Site", target: "rs11575996", value: 10 },
    { source: "rs11575996", target: "stomach cancer", value: 10 },
    { source: "rs863224499", target: "ovarian cancer", value: 10 },
    { source: "rs11575997", target: "ovarian cancer", value: 10 },
    { source: "rs11575996", target: "ovarian cancer", value: 10 },
    { source: "rs969930693", target: "ovarian cancer", value: 10 },
    { source: "rs1064795056", target: "ovarian cancer", value: 10 },
    { source: "rs1057520387", target: "ovarian cancer", value: 10 },
    { source: "rs1310956961", target: "ovarian cancer", value: 10 },
    { source: "rs886041285", target: "ovarian cancer", value: 10 },
    { source: "rs876660156", target: "ovarian cancer", value: 10 },
    { source: "rs1131691033", target: "ovarian cancer", value: 10 },
    { source: "rs1267047192", target: "ovarian cancer", value: 10 },
    { source: "rs730881997", target: "ovarian cancer", value: 10 },
    { source: "rs1057520003", target: "ovarian cancer", value: 10 },
    { source: "ovarian cancer", target: "Mitotane", value: 10 },
    { source: "ovarian cancer", target: "Tivozanib", value: 10 },
    { source: "ovarian cancer", target: "Sorafenib", value: 10 },
    { source: "ovarian cancer", target: "Reniale", value: 10 },
    { source: "ovarian cancer", target: "Everolimus", value: 10 },
    { source: "ovarian cancer", target: "Pazopanib", value: 10 },
    { source: "ovarian cancer", target: "Temsirolimus", value: 10 },
    { source: "ovarian cancer", target: "CreaVax-RCC", value: 10 },
    { source: "ovarian cancer", target: "Aldesleukin", value: 10 },
    { source: "ovarian cancer", target: "Sifalimumab", value: 10 },
    { source: "ovarian cancer", target: "Axitinib", value: 10 },
    { source: "ovarian cancer", target: "Tremetinib", value: 10 },
    { source: "ovarian cancer", target: "Ramucirumab", value: 10 },
    { source: "ovarian cancer", target: "Antacids", value: 10 },
    { source: "rs786201057", target: "ovarian cancer", value: 10 },
    { source: "rs1131691042", target: "ovarian cancer", value: 10 },
    { source: "rs11575997", target: "pancreatic cancer", value: 10 },
    { source: "rs863224499", target: "pancreatic cancer", value: 10 },
    { source: "rs1131691042", target: "pancreatic cancer", value: 10 },
    { source: "rs786201057", target: "pancreatic cancer", value: 10 },
    { source: "pancreatic cancer", target: "Mitotane", value: 10 },
    { source: "pancreatic cancer", target: "Axitinib", value: 10 },
    { source: "pancreatic cancer", target: "Sifalimumab", value: 10 },
    { source: "pancreatic cancer", target: "Aldesleukin", value: 10 },
    { source: "pancreatic cancer", target: "CreaVax-RCC", value: 10 },
    { source: "pancreatic cancer", target: "Temsirolimus", value: 10 },
    { source: "pancreatic cancer", target: "Pazopanib", value: 10 },
    { source: "pancreatic cancer", target: "Everolimus", value: 10 },
    { source: "pancreatic cancer", target: "Reniale", value: 10 },
    { source: "pancreatic cancer", target: "Sorafenib", value: 10 },
    { source: "pancreatic cancer", target: "Tivozanib", value: 10 },
    { source: "pancreatic cancer", target: "Tremetinib", value: 10 },
    { source: "pancreatic cancer", target: "Antacids", value: 10 },
    { source: "pancreatic cancer", target: "Ramucirumab", value: 10 },
    { source: "rs1057520003", target: "pancreatic cancer", value: 10 },
    { source: "rs730881997", target: "pancreatic cancer", value: 10 },
    { source: "rs1267047192", target: "pancreatic cancer", value: 10 },
    { source: "rs1131691033", target: "pancreatic cancer", value: 10 },
    { source: "rs876660156", target: "pancreatic cancer", value: 10 },
    { source: "rs886041285", target: "pancreatic cancer", value: 10 },
    { source: "rs1310956961", target: "pancreatic cancer", value: 10 },
    { source: "rs1057520387", target: "pancreatic cancer", value: 10 },
    { source: "rs1064795056", target: "pancreatic cancer", value: 10 },
    { source: "rs969930693", target: "pancreatic cancer", value: 10 },
    { source: "rs11575996", target: "pancreatic cancer", value: 10 },
    { source: "rs863224499", target: "brain cancer", value: 10 },
    { source: "rs11575997", target: "brain cancer", value: 10 },
    { source: "rs11575996", target: "brain cancer", value: 10 },
    { source: "rs969930693", target: "brain cancer", value: 10 },
    { source: "rs1064795056", target: "brain cancer", value: 10 },
    { source: "rs1057520387", target: "brain cancer", value: 10 },
    { source: "rs1310956961", target: "brain cancer", value: 10 },
    { source: "rs886041285", target: "brain cancer", value: 10 },
    { source: "rs876660156", target: "brain cancer", value: 10 },
    { source: "rs1131691033", target: "brain cancer", value: 10 },
    { source: "rs1267047192", target: "brain cancer", value: 10 },
    { source: "rs730881997", target: "brain cancer", value: 10 },
    { source: "rs1057520003", target: "brain cancer", value: 10 },
    { source: "brain cancer", target: "Mitotane", value: 10 },
    { source: "brain cancer", target: "Tivozanib", value: 10 },
    { source: "brain cancer", target: "Sorafenib", value: 10 },
    { source: "brain cancer", target: "Reniale", value: 10 },
    { source: "brain cancer", target: "Everolimus", value: 10 },
    { source: "brain cancer", target: "Pazopanib", value: 10 },
    { source: "brain cancer", target: "Temsirolimus", value: 10 },
    { source: "brain cancer", target: "CreaVax-RCC", value: 10 },
    { source: "brain cancer", target: "Aldesleukin", value: 10 },
    { source: "brain cancer", target: "Sifalimumab", value: 10 },
    { source: "brain cancer", target: "Axitinib", value: 10 },
    { source: "brain cancer", target: "Tremetinib", value: 10 },
    { source: "brain cancer", target: "Ramucirumab", value: 10 },
    { source: "brain cancer", target: "Antacids", value: 10 },
    { source: "rs786201057", target: "brain cancer", value: 10 },
    { source: "rs1131691042", target: "brain cancer", value: 10 },
    { source: "rs1064795056", target: "sarcoma", value: 10 },
    { source: "rs863224499", target: "sarcoma", value: 10 },
    { source: "rs1131691042", target: "sarcoma", value: 10 },
    { source: "rs786201057", target: "sarcoma", value: 10 },
    { source: "sarcoma", target: "Mitotane", value: 10 },
    { source: "sarcoma", target: "Axitinib", value: 10 },
    { source: "sarcoma", target: "Sifalimumab", value: 10 },
    { source: "sarcoma", target: "Aldesleukin", value: 10 },
    { source: "sarcoma", target: "CreaVax-RCC", value: 10 },
    { source: "sarcoma", target: "Temsirolimus", value: 10 },
    { source: "sarcoma", target: "Pazopanib", value: 10 },
    { source: "sarcoma", target: "Everolimus", value: 10 },
    { source: "sarcoma", target: "Reniale", value: 10 },
    { source: "sarcoma", target: "Sorafenib", value: 10 },
    { source: "sarcoma", target: "Tivozanib", value: 10 },
    { source: "sarcoma", target: "Tremetinib", value: 10 },
    { source: "sarcoma", target: "Antacids", value: 10 },
    { source: "sarcoma", target: "Ramucirumab", value: 10 },
    { source: "rs1057520003", target: "sarcoma", value: 10 },
    { source: "rs730881997", target: "sarcoma", value: 10 },
    { source: "rs1267047192", target: "sarcoma", value: 10 },
    { source: "rs1131691033", target: "sarcoma", value: 10 },
    { source: "rs876660156", target: "sarcoma", value: 10 },
    { source: "rs886041285", target: "sarcoma", value: 10 },
    { source: "rs1310956961", target: "sarcoma", value: 10 },
    { source: "rs1057520387", target: "sarcoma", value: 10 },
    { source: "rs969930693", target: "sarcoma", value: 10 },
    { source: "rs11575996", target: "sarcoma", value: 10 },
    { source: "rs11575997", target: "sarcoma", value: 10 },
    { source: "rs11575997", target: "head and neck cancer", value: 10 },
    { source: "rs11575996", target: "head and neck cancer", value: 10 },
    { source: "rs969930693", target: "head and neck cancer", value: 10 },
    { source: "rs1064795056", target: "head and neck cancer", value: 10 },
    { source: "rs1057520387", target: "head and neck cancer", value: 10 },
    { source: "rs1310956961", target: "head and neck cancer", value: 10 },
    { source: "rs886041285", target: "head and neck cancer", value: 10 },
    { source: "rs876660156", target: "head and neck cancer", value: 10 },
    { source: "rs1131691033", target: "head and neck cancer", value: 10 },
    { source: "rs1267047192", target: "head and neck cancer", value: 10 },
    { source: "rs730881997", target: "head and neck cancer", value: 10 },
    { source: "rs1057520003", target: "head and neck cancer", value: 10 },
    { source: "head and neck cancer", target: "Mitotane", value: 10 },
    { source: "head and neck cancer", target: "Tivozanib", value: 10 },
    { source: "head and neck cancer", target: "Sorafenib", value: 10 },
    { source: "head and neck cancer", target: "Reniale", value: 10 },
    { source: "head and neck cancer", target: "Everolimus", value: 10 },
    { source: "head and neck cancer", target: "Pazopanib", value: 10 },
    { source: "head and neck cancer", target: "Temsirolimus", value: 10 },
    { source: "head and neck cancer", target: "CreaVax-RCC", value: 10 },
    { source: "head and neck cancer", target: "Aldesleukin", value: 10 },
    { source: "head and neck cancer", target: "Sifalimumab", value: 10 },
    { source: "rs863224499", target: "head and neck cancer", value: 10 },
    { source: "head and neck cancer", target: "Axitinib", value: 10 },
    { source: "head and neck cancer", target: "Tremetinib", value: 10 },
    { source: "head and neck cancer", target: "Ramucirumab", value: 10 },
    { source: "head and neck cancer", target: "Antacids", value: 10 },
    { source: "rs786201057", target: "head and neck cancer", value: 10 },
    { source: "rs1131691042", target: "head and neck cancer", value: 10 },
    { source: "rs863224499", target: "cervical cancer", value: 10 },
    { source: "rs1131691042", target: "cervical cancer", value: 10 },
    { source: "rs786201057", target: "cervical cancer", value: 10 },
    { source: "cervical cancer", target: "Mitotane", value: 10 },
    { source: "cervical cancer", target: "Axitinib", value: 10 },
    { source: "cervical cancer", target: "Sifalimumab", value: 10 },
    { source: "cervical cancer", target: "Aldesleukin", value: 10 },
    { source: "cervical cancer", target: "CreaVax-RCC", value: 10 },
    { source: "cervical cancer", target: "Temsirolimus", value: 10 },
    { source: "cervical cancer", target: "Pazopanib", value: 10 },
    { source: "cervical cancer", target: "Everolimus", value: 10 },
    { source: "cervical cancer", target: "Reniale", value: 10 },
    { source: "cervical cancer", target: "Sorafenib", value: 10 },
    { source: "cervical cancer", target: "Tivozanib", value: 10 },
    { source: "cervical cancer", target: "Tremetinib", value: 10 },
    { source: "cervical cancer", target: "Antacids", value: 10 },
    { source: "cervical cancer", target: "Ramucirumab", value: 10 },
    { source: "rs1057520003", target: "cervical cancer", value: 10 },
    { source: "rs730881997", target: "cervical cancer", value: 10 },
    { source: "rs1267047192", target: "cervical cancer", value: 10 },
    { source: "rs1131691033", target: "cervical cancer", value: 10 },
    { source: "rs876660156", target: "cervical cancer", value: 10 },
    { source: "rs886041285", target: "cervical cancer", value: 10 },
    { source: "rs1310956961", target: "cervical cancer", value: 10 },
    { source: "rs1057520387", target: "cervical cancer", value: 10 },
    { source: "rs1064795056", target: "cervical cancer", value: 10 },
    { source: "rs969930693", target: "cervical cancer", value: 10 },
    { source: "rs11575996", target: "cervical cancer", value: 10 },
    { source: "rs11575997", target: "cervical cancer", value: 10 },
    { source: "rs1057520003", target: "esophageal cancer", value: 10 },
    { source: "esophageal cancer", target: "Sifalimumab", value: 10 },
    { source: "rs11575997", target: "esophageal cancer", value: 10 },
    { source: "rs11575996", target: "esophageal cancer", value: 10 },
    { source: "rs969930693", target: "esophageal cancer", value: 10 },
    { source: "rs1064795056", target: "esophageal cancer", value: 10 },
    { source: "rs1057520387", target: "esophageal cancer", value: 10 },
    { source: "rs1310956961", target: "esophageal cancer", value: 10 },
    { source: "rs886041285", target: "esophageal cancer", value: 10 },
    { source: "rs876660156", target: "esophageal cancer", value: 10 },
    { source: "rs1131691033", target: "esophageal cancer", value: 10 },
    { source: "rs863224499", target: "esophageal cancer", value: 10 },
    { source: "rs1267047192", target: "esophageal cancer", value: 10 },
    { source: "rs730881997", target: "esophageal cancer", value: 10 },
    { source: "esophageal cancer", target: "Mitotane", value: 10 },
    { source: "esophageal cancer", target: "Tivozanib", value: 10 },
    { source: "esophageal cancer", target: "Sorafenib", value: 10 },
    { source: "esophageal cancer", target: "Reniale", value: 10 },
    { source: "esophageal cancer", target: "Everolimus", value: 10 },
    { source: "esophageal cancer", target: "Pazopanib", value: 10 },
    { source: "esophageal cancer", target: "Temsirolimus", value: 10 },
    { source: "esophageal cancer", target: "CreaVax-RCC", value: 10 },
    { source: "esophageal cancer", target: "Aldesleukin", value: 10 },
    { source: "esophageal cancer", target: "Axitinib", value: 10 },
    { source: "esophageal cancer", target: "Tremetinib", value: 10 },
    { source: "esophageal cancer", target: "Ramucirumab", value: 10 },
    { source: "esophageal cancer", target: "Antacids", value: 10 },
    { source: "rs786201057", target: "esophageal cancer", value: 10 },
    { source: "rs1131691042", target: "esophageal cancer", value: 10 },
    { source: "rs1057520003", target: "fallopian tube cancer", value: 10 },
    { source: "fallopian tube cancer", target: "Axitinib", value: 10 },
    { source: "rs1131691042", target: "fallopian tube cancer", value: 10 },
    { source: "rs786201057", target: "fallopian tube cancer", value: 10 },
    { source: "fallopian tube cancer", target: "Mitotane", value: 10 },
    { source: "fallopian tube cancer", target: "Sifalimumab", value: 10 },
    { source: "fallopian tube cancer", target: "Aldesleukin", value: 10 },
    { source: "fallopian tube cancer", target: "CreaVax-RCC", value: 10 },
    { source: "fallopian tube cancer", target: "Temsirolimus", value: 10 },
    { source: "fallopian tube cancer", target: "Pazopanib", value: 10 },
    { source: "fallopian tube cancer", target: "Everolimus", value: 10 },
    { source: "fallopian tube cancer", target: "Reniale", value: 10 },
    { source: "fallopian tube cancer", target: "Sorafenib", value: 10 },
    { source: "fallopian tube cancer", target: "Tivozanib", value: 10 },
    { source: "fallopian tube cancer", target: "Tremetinib", value: 10 },
    { source: "fallopian tube cancer", target: "Antacids", value: 10 },
    { source: "fallopian tube cancer", target: "Ramucirumab", value: 10 },
    { source: "rs730881997", target: "fallopian tube cancer", value: 10 },
    { source: "rs1267047192", target: "fallopian tube cancer", value: 10 },
    { source: "rs1131691033", target: "fallopian tube cancer", value: 10 },
    { source: "rs876660156", target: "fallopian tube cancer", value: 10 },
    { source: "rs886041285", target: "fallopian tube cancer", value: 10 },
    { source: "rs1310956961", target: "fallopian tube cancer", value: 10 },
    { source: "rs1057520387", target: "fallopian tube cancer", value: 10 },
    { source: "rs1064795056", target: "fallopian tube cancer", value: 10 },
    { source: "rs969930693", target: "fallopian tube cancer", value: 10 },
    { source: "rs11575996", target: "fallopian tube cancer", value: 10 },
    { source: "rs11575997", target: "fallopian tube cancer", value: 10 },
    { source: "rs863224499", target: "fallopian tube cancer", value: 10 },
  ],
};

var margin = { top: 1, right: 1, bottom: 6, left: 1 },
  width = 9600 - margin.left - margin.right,
  height = 500 - margin.top - margin.bottom;
const drawChart = (energyjson) => {
  // var sankey = d3.sankey().nodeWidth(15).nodePadding(10).size([width, height]);
  var sankey = d3.sankey().nodeWidth(15).nodePadding(10).size([width, height]);
  let color_types = {
    hugo_symbol: "#1f77b4",
    variant_classification: "#17becf",
    dbsnp_rs: "#ff7f0e",
    diseasename: "#e377c2",
    drugname: "#9467bd",
  };
  let nodesLength = energyjson.nodes;

  var formatNumber = d3.format(",.0f"),
    format = function (d) {
      return formatNumber(d) + " TWh";
    },
    color = d3.scale.category20();

  var svg1 = d3
    .select(`#${idName}`)
    .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", "500")
    .attr("class", "inline mt-5");
  var svg = svg1
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  var path = sankey.link();
  var nodeMap = {};
  let maxNode = {
    hugo_symbol: 0,
    variant_classification: 0,
    dbsnp_rs: 0,
    diseasename: 0,
    drugname: 0,
  };
  energyjson.nodes.forEach(function (x) {
    nodeMap[x.name] = x;
    maxNode[x["type"]] = maxNode[x["type"]] + 1;
  });
  let maxNameCount = 0;
  let maxName = "";
  for (const key in maxNode) {
    if (maxNode[key] > maxNameCount) {
      maxNameCount = maxNode[key];
      maxName = key;
    }
  }
  energyjson.links = energyjson.links.map(function (x) {
    return {
      source: nodeMap[x.source],
      target: nodeMap[x.target],
      value: x.value,
    };
  });
  sankey.nodes(energyjson.nodes).links(energyjson.links).layout(32);

  var link = svg
    .append("g")
    .selectAll(".link")
    .data(energyjson.links)
    .enter()
    .append("path")
    .attr("class", "link")
    .attr("d", path)
    .attr("id", function (d, i) {
      d.id = i;
      return "link-" + i;
    })
    .style("stroke-width", function (d) {
      return Math.max(1, d.dy);
    })
    .sort(function (a, b) {
      return b.dy - a.dy;
    });

  link.append("title").text(function (d) {
    return d.source.name + "  " + d.target.name + "\n" + format(d.value);
  });

  var node = svg
    .append("g")
    .selectAll(".node")
    .data(energyjson.nodes)
    .enter()
    .append("g")
    .attr("class", "node")
    .attr("transform", function (d) {
      return "translate(" + d.x + "," + d.y + ")";
    })
    .on("click", highlight_node_links)
    .call(
      d3.behavior
        .drag()
        .origin(function (d) {
          return d;
        })
        // interfering with click .on("dragstart", function() { this.parentNode.appendChild(this); })
        .on("drag", dragmove)
    );
  var heigthCalc = 0;
  node
    .append("rect")
    .attr("height", function (d) {
      if (d["type"] === maxName) {
        heigthCalc = heigthCalc + d.dy;
      }
      return d.dy;
    })
    .attr("width", sankey.nodeWidth())
    .style("fill", function (d) {
      let t = d["type"];
      return color_types[t];
      // return d.color = color(d.name.replace(/ .*/, ""));
    })
    .style("stroke", function (d) {
      return d3.rgb(d.color).darker(2);
    })
    .append("title")
    .text(function (d) {
      return d.name + "\n" + format(d.value);
    });

  node
    .append("text")
    .attr("x", -6)
    .attr("y", function (d) {
      return d.dy / 2;
    })
    .attr("dy", ".35em")
    .attr("text-anchor", "end")
    .attr("transform", null)
    .text(function (d) {
      return d.name;
    })
    .filter(function (d) {
      return d.x < width / 2;
    })
    .attr("x", 6 + sankey.nodeWidth())
    .attr("text-anchor", "start");

  function dragmove(d) {
    d3.select(this).attr(
      "transform",
      "translate(" +
        d.x +
        "," +
        (d.y = Math.max(0, Math.min(height - d.dy, d3.event.y))) +
        ")"
    );
    sankey.relayout();
    link.attr("d", path);
  }

  function highlight_node_links(node, i) {
    var remainingNodes = [],
      nextNodes = [];

    var stroke_opacity = 0;
    if (d3.select(this).attr("data-clicked") == "1") {
      d3.select(this).attr("data-clicked", "0");
      stroke_opacity = 0.2;
    } else {
      d3.select(this).attr("data-clicked", "1");
      stroke_opacity = 0.5;
    }

    var traverse = [
      {
        linkType: "sourceLinks",
        nodeType: "target",
      },
      {
        linkType: "targetLinks",
        nodeType: "source",
      },
    ];

    traverse.forEach(function (step) {
      node[step.linkType].forEach(function (link) {
        remainingNodes.push(link[step.nodeType]);
        highlight_link(link.id, stroke_opacity);
      });

      while (remainingNodes.length) {
        nextNodes = [];
        remainingNodes.forEach(function (node) {
          node[step.linkType].forEach(function (link) {
            nextNodes.push(link[step.nodeType]);
            highlight_link(link.id, stroke_opacity);
          });
        });
        remainingNodes = nextNodes;
      }
    });
  }

  function highlight_link(id, opacity) {
    d3.select("#link-" + id).style("stroke-opacity", opacity);
  }
  svg1.attr("height", 400 + heigthCalc);
};

if (SankeyJson) {
  if (document.getElementById(idName)) {
    document.getElementById(idName).innerHTML = "";
  }
  let j = SankeyJson;
  drawChart(j);
}
